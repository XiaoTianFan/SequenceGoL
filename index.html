<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SequenceGoL</title>
  <link rel="stylesheet" href="src/main.css" />
</head>

<body>
  <button class="panel-toggle" id="panelToggle" aria-controls="controlPanel" aria-expanded="false">Controls</button>
  <button class="about-toggle" id="aboutToggle" aria-haspopup="dialog" aria-controls="aboutOverlay">About</button>

  <aside class="control-panel" id="controlPanel" aria-label="Simulation and music controls">
    <div class="panel-inner">
      <div class="panel-header">
        <div>
          <h1>SequenceGoL</h1>
          <p class="muted">MIDI-mapped procedural grid sequencer using multiple automata rules.</p>
        </div>
        <button class="icon-button" id="panelClose" aria-label="Close controls">×</button>
      </div>

      <section class="panel-section glass-panel">
        <header class="section-heading">
          <h2>Simulation</h2>
          <span class="badge">Live</span>
        </header>
        <div class="button-row">
          <button id="startBtn" class="cta">Start</button>
          <button id="stopBtn" class="cta ghost" disabled>Stop</button>
          <button id="clearBtn" class="cta warning">Clear</button>
        </div>
        <label class="field">
          <span>Simulation BPM</span>
          <div class="field-input bpm-control">
            <input type="range" id="simBpmSlider" min="30" max="600" value="75" step="5" />
            <input type="number" id="simBpmInput" min="30" max="600" value="75" step="5" />
            <span id="simBpmValue" class="value-chip">75 BPM · 1/4</span>
          </div>
        </label>
        <label class="field">
          <span>Simulation Beat Unit</span>
          <div class="custom-select" data-select="simBeatUnitSelect">
            <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Quarter
              note (1/4)</button>
            <div class="custom-select-options" role="listbox"></div>
          </div>
          <select id="simBeatUnitSelect" class="native-select" aria-hidden="true">
            <option value="1">Whole note (1/1)</option>
            <option value="0.5">Half note (1/2)</option>
            <option value="0.25" selected>Quarter note (1/4)</option>
            <option value="0.125">Eighth note (1/8)</option>
            <option value="0.0625">Sixteenth note (1/16)</option>
          </select>
        </label>
        <label class="field">
          <span>Rule Set</span>
          <div class="custom-select" data-select="ruleSelect">
            <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
              rule</button>
            <div class="custom-select-options" role="listbox"></div>
          </div>
          <select id="ruleSelect" class="native-select" aria-hidden="true">
            <option value="conway">Conway's Game of Life</option>
            <option value="highlife">HighLife</option>
            <option value="seeds">Seeds</option>
            <option value="starwars">Star Wars</option>
            <option value="briansbrain">Brian's Brain</option>
            <option value="diamoeba">Diamoeba</option>
          </select>
        </label>
        <div class="generation-display">
          <p class="label">Generation</p>
          <p class="value" id="generation">0</p>
        </div>

        <label class="field">
          <span>Random Fill Amount</span>
          <div class="field-input bpm-control">
            <input type="range" id="randomFillSlider" min="5" max="90" value="35" step="5" />
            <span id="randomFillValue" class="value-chip">35%</span>
          </div>
        </label>

        <label class="field">
          <span>Random Pattern</span>
          <div class="custom-select" data-select="randomFillAlgorithmSelect">
            <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
              pattern</button>
            <div class="custom-select-options" role="listbox"></div>
          </div>
          <select id="randomFillAlgorithmSelect" class="native-select" aria-hidden="true">
            <option value="uniform" selected>Uniform scatter</option>
            <option value="clusters">Cluster blooms</option>
            <option value="noise">Fractal noise</option>
          </select>
        </label>

        <div class="button-row random-fill-row">
          <button id="randomFillBtn" type="button" class="cta outline">Random Fill</button>
        </div>
      </section>

      <section class="panel-section glass-panel">
        <header class="section-heading">
          <h2>Music</h2>
          <span class="badge accent" id="musicScaleLabel">A Phrygian Dominant</span>
        </header>
        <div class="button-row">
          <button id="musicStartBtn" class="cta">Start Music</button>
          <button id="musicStopBtn" class="cta ghost" disabled>Stop Music</button>
        </div>
        <label class="field">
          <span>Music BPM</span>
          <div class="field-input bpm-control">
            <input type="range" id="bpmSlider" min="60" max="200" value="75" step="5" />
            <input type="number" id="bpmInput" min="30" max="300" value="75" step="1" />
            <span id="bpmValue" class="value-chip">75 BPM · 1/4</span>
          </div>
        </label>
        <label class="field">
          <span>Music Beat Unit</span>
          <div class="custom-select" data-select="musicBeatUnitSelect">
            <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Quarter
              note (1/4)</button>
            <div class="custom-select-options" role="listbox"></div>
          </div>
          <select id="musicBeatUnitSelect" class="native-select" aria-hidden="true">
            <option value="1">Whole note (1/1)</option>
            <option value="0.5">Half note (1/2)</option>
            <option value="0.25" selected>Quarter note (1/4)</option>
            <option value="0.125">Eighth note (1/8)</option>
            <option value="0.0625">Sixteenth note (1/16)</option>
          </select>
        </label>
        <label class="field">
          <span>Active Columns</span>
          <div class="field-input bpm-control">
            <input type="range" id="columnSlider" min="4" max="16" value="8" step="1" />
            <input type="number" id="columnInput" min="4" max="16" value="8" step="1" />
            <span id="columnValue" class="value-chip">8 Columns</span>
          </div>
        </label>
        <label class="field">
          <span>Spawn Mode</span>
          <div class="custom-select" data-select="spawnModeSelect">
            <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
              mode</button>
            <div class="custom-select-options" role="listbox"></div>
          </div>
          <select id="spawnModeSelect" class="native-select" aria-hidden="true">
            <option value="cascade" selected>Cascade</option>
            <option value="scanning">Scanning</option>
            <option value="sequencer">Sequencer</option>
          </select>
        </label>
        <label class="field" id="sequencerSubModeField" style="display: none;">
          <span>Sequencer Pattern</span>
          <div class="custom-select" data-select="sequencerSubModeSelect">
            <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
              pattern</button>
            <div class="custom-select-options" role="listbox"></div>
          </div>
          <select id="sequencerSubModeSelect" class="native-select" aria-hidden="true">
            <option value="horizontal" selected>Horizontal</option>
            <option value="vertical">Vertical</option>
            <option value="diagonal">Diagonal</option>
            <option value="spiral">Spiral</option>
          </select>
        </label>
        <label class="field">
          <span>Spawn Probability</span>
          <div class="field-input bpm-control">
            <input type="range" id="spawnRateSlider" min="0.25" max="4" value="1" step="0.25" />
            <input type="number" id="spawnRateInput" min="0.25" max="4" value="1" step="0.25" />
            <span id="spawnRateValue" class="value-chip">1.0×</span>
          </div>
        </label>
        <label class="field">
          <span>MIDI Output</span>
          <div class="field-input midi-select">
            <div class="custom-select" data-select="midiOutputSelect">
              <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
                device</button>
              <div class="custom-select-options" role="listbox"></div>
            </div>
            <button id="refreshMidiBtn" class="icon-button" aria-label="Refresh MIDI devices" disabled>↻</button>
          </div>
          <select id="midiOutputSelect" class="native-select" aria-hidden="true">
            <option value="">Not connected</option>
          </select>
        </label>
        <button id="noteConfigBtn" class="cta outline">Note timing & thresholds</button>
      </section>

      <section class="panel-section glass-panel" id="midiStatus" aria-live="polite">
        <header class="section-heading">
          <h2>MIDI Status</h2>
        </header>
        <p class="muted" id="midiStatusText">Web MIDI not connected. Click "Connect MIDI" to enable MIDI output.</p>
        <div class="button-row">
          <button id="connectMidiBtn" class="cta">Connect MIDI</button>
        </div>
      </section>
    </div>
  </aside>

  <main class="stage" aria-live="polite">
    <div class="canvas-wrapper glass-panel" aria-label="Cellular automata grid">
      <div id="grid" class="grid"></div>
    </div>
  </main>

  <section class="overlay" id="aboutOverlay" aria-hidden="true" role="dialog" aria-labelledby="aboutTitle">
    <div class="overlay-content glass-panel">
      <header class="overlay-header">
        <div>
          <p class="eyebrow">Systems Brief</p>
          <h2 id="aboutTitle">About the Canvas</h2>
        </div>
        <button class="icon-button" data-overlay-close="aboutOverlay" aria-label="Close about panel">×</button>
      </header>
      <div class="overlay-body">
        <p>Left click and drag to seed living cells. Right click scrubs cells back to stasis. Multiple automata rules
          are supported: Conway's B3/S23, HighLife B36/S23, Seeds B2/S, Star Wars B2/S345, Brian's Brain (three-state),
          and Diamoeba B35678/S5678.</p>
        <p>The MIDI engine scans eleven stacked 8×8 sectors, mapped to an A Phrygian Dominant scale across channels
          1–11. Music BPM and beat lengths are independent from simulation tempo, allowing polyrhythmic drift.</p>
        <p>Route the Web MIDI output into any DAW or hardware synth to hear evolving harmonies.</p>
      </div>
    </div>
  </section>

  <section class="overlay" id="noteConfigOverlay" aria-hidden="true" role="dialog" aria-labelledby="noteConfigTitle">
    <div class="overlay-content glass-panel note-config">
      <header class="overlay-header">
        <div>
          <p class="eyebrow">Music Layers</p>
          <h2 id="noteConfigTitle">Note timing & activation thresholds</h2>
        </div>
        <button class="icon-button" data-overlay-close="noteConfigOverlay"
          aria-label="Close note configuration">×</button>
      </header>
      <div class="overlay-body">
        <section class="key-presets">
          <header class="section-heading compact">
            <h3>Key Presets</h3>
            <span class="badge accent" id="currentScaleLabel">A Phrygian Dominant</span>
          </header>
          <div class="key-presets-controls">
            <label class="field">
              <span>Tonic Note</span>
              <div class="custom-select" data-select="keyTonicSelect">
                <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
                  tonic</button>
                <div class="custom-select-options" role="listbox"></div>
              </div>
              <select id="keyTonicSelect" class="native-select" aria-hidden="true">
                <option value="C">C</option>
                <option value="C#">C♯ / D♭</option>
                <option value="D">D</option>
                <option value="D#">D♯ / E♭</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="F#">F♯ / G♭</option>
                <option value="G">G</option>
                <option value="G#">G♯ / A♭</option>
                <option value="A" selected>A</option>
                <option value="A#">A♯ / B♭</option>
                <option value="B">B</option>
              </select>
            </label>

            <label class="field">
              <span>Scale Type</span>
              <div class="custom-select" data-select="keyScaleSelect">
                <button type="button" class="custom-select-toggle" aria-haspopup="listbox" aria-expanded="false">Select
                  scale</button>
                <div class="custom-select-options" role="listbox"></div>
              </div>
              <select id="keyScaleSelect" class="native-select" aria-hidden="true">
                <option value="major">Ionian (Major)</option>
                <option value="dorian">Dorian</option>
                <option value="phrygian">Phrygian</option>
                <option value="lydian">Lydian</option>
                <option value="mixolydian">Mixolydian</option>
                <option value="minor">Aeolian (Natural Minor)</option>
                <option value="locrian">Locrian</option>
                <option value="harmonic_minor">Harmonic Minor</option>
                <option value="phrygian_dominant" selected>Phrygian Dominant</option>
                <option value="whole_tone">Whole Tone</option>
                <option value="chromatic">Chromatic</option>
              </select>
            </label>

            <label class="field">
              <span>Min Octave</span>
              <div class="custom-select" data-select="minOctaveSelect">
                <button type="button" class="custom-select-toggle" aria-haspopup="listbox"
                  aria-expanded="false">4</button>
                <div class="custom-select-options" role="listbox"></div>
              </div>
              <select id="minOctaveSelect" class="native-select" aria-hidden="true">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected>4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
              </select>
            </label>

            <label class="field">
              <span>Max Octave</span>
              <div class="custom-select" data-select="maxOctaveSelect">
                <button type="button" class="custom-select-toggle" aria-haspopup="listbox"
                  aria-expanded="false">4</button>
                <div class="custom-select-options" role="listbox"></div>
              </div>
              <select id="maxOctaveSelect" class="native-select" aria-hidden="true">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4" selected>4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
              </select>
            </label>

            <div class="key-presets-actions">
              <button id="randomizeKeyPresetBtn" class="cta ghost">Randomize</button>
            </div>
          </div>
        </section>

        <div id="noteConfigGrid" class="note-grid"></div>
      </div>
    </div>
  </section>

  <script type="module" src="/src/main.js"></script>
</body>

</html>